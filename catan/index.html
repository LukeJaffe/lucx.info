<html>

<head>

<script src="/socket.io/socket.io.js"></script>
<script src="/utils/jquery-1.11.3.min.js"></script>

<style>

h1
{
    color: black;
    text-align: center;
    font-family: "Calibri";
    font-size: xx-large;
}

h2
{
    position: fixed;
    top: 250px;
    left: 50px;
    color: red;
    text-align: center;
    font-family: "Calibri";
    font-size: large;
}

</style>
</head>

<body>

<h1>Catan Lobby</h1>

<table id="game_table" border="1" cellpadding="5" cellspacing="5">
    <tr>
        <td><input type="submit" id="new_button" value="New"></a></td>
        <td></td>
        <td>
            <select id="player_select">
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
            </select>
        </td>
    </tr>
</table>

<h2></h2>

<script>

var socket = io.connect();
var username = "GUEST";

/* Get username from session data */
$.post( "http://lucx.info/session", function(response)
{
    username = response;
});

setup_table();
get_games();

function setup_table()
{
    var table = document.getElementById("game_table");
    var row = table.insertRow(0);
    var cell1 = row.insertCell(0);
    var cell2 = row.insertCell(1);
    var cell3 = row.insertCell(2);
    cell1.innerHTML = "<th><b>Game</b></th>";
    cell2.innerHTML = "<th><b>Host</b></th>";
    cell3.innerHTML = "<th><b>Players</b></th>";
}

function get_games()
{
    socket.emit('get_games', {});
}

socket.on('game_data', function(data)
{
    var table = document.getElementById("game_table");

    // Remove all entries currently in games table
    var len = table.rows.length;
    while (table.rows.length > 2)
    {
        table.deleteRow(table.rows.length-1);
    }

    // Add entries to games table 
    var games = data.games;
    for (var i = 0; i < games.length; i++)
    {
        var row = table.insertRow(2);
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        var cell3 = row.insertCell(2);
        cell1.innerHTML = "<td><a href='javascript:void(0);' onclick='join_game(\""+games[i].id+"\");'>"+"Game "+games[i].id+"</a></td>";
        cell2.innerHTML = "<td>"+games[i].host+"</td>";
        cell3.innerHTML = "<td>"+games[i].max_players+"</td>";
    }
});

// Jquery button to add new game
$('#new_button').click(function()
{
    if (username != "GUEST")
    {
        var max_players = document.getElementById("player_select").value;
        socket.emit('new_game', {'host': username, 'max_players': max_players});
    }
    else
    {
        console.log("Login to create game");
    }
});

socket.on('new_game_success', function()
{
    get_games();
});

socket.on('new_game_failure', function()
{
    $("h2").html("This host has already created a game.");
});

function join_game(id)
{
    console.log("Joining game: "+id);
}

// Javascript function to join game
/*
function join_game(game)
{
    $.post("http://lucx.info/catan/join_game.php", {game: game}, function(response)
    {
        if (response == 0 || response == 1)
            window.location.href = "http://lucx.info/catan/setup.html";
        else
            $("h2").html(response);
    });
}
*/

</script>

</body>

<html>

